---
import type { MarkdownHeading } from "astro";
import { generateToc } from "@/lib/utils";

import TOCHeading from "./TOCHeading.astro";

interface Props {
	headings: MarkdownHeading[];
}

const { headings } = Astro.props;

const toc = generateToc(headings);
---

<nav class="toc-container text-sm">
	<button
		id="toc-toggle"
		class="text-muted-foreground hover:text-foreground mb-3 flex items-center gap-2 transition-colors"
		aria-expanded="true"
		aria-controls="toc-list"
	>
		<span id="toc-icon" class="iconify ri--menu-line text-lg transition-transform duration-300"
		></span>
	</button>

	<div id="toc-wrapper" class="toc-wrapper">
		<ul id="toc-list" class="flex flex-col text-pretty">
			{toc.map((heading) => <TOCHeading heading={heading} />)}
		</ul>
	</div>
</nav>

<script>
	document.addEventListener("astro:page-load", () => {
		const toggle = document.getElementById("toc-toggle");
		const wrapper = document.getElementById("toc-wrapper");
		const icon = document.getElementById("toc-icon");

		if (toggle && wrapper && icon) {
			toggle.addEventListener("click", () => {
				const isExpanded = toggle.getAttribute("aria-expanded") === "true";
				toggle.setAttribute("aria-expanded", (!isExpanded).toString());
				wrapper.classList.toggle("collapsed");
			});
		}
	});
</script>

<style>
	.toc-wrapper {
		display: grid;
		grid-template-rows: 1fr;
		transition: grid-template-rows 0.5s ease-out;
	}

	.toc-wrapper > ul {
		overflow: hidden;
	}

	.toc-wrapper.collapsed {
		grid-template-rows: 0fr;
	}
</style>
