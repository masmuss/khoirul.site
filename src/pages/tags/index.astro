---
import PageLayout from "@/layouts/BaseLayout.astro";
import { getAllPosts, getUniqueTagsWithCount } from "@/lib/utils";

const allPosts = await getAllPosts();
const allTags = getUniqueTagsWithCount(allPosts);

const sortedTags = [...allTags].sort((a, b) => {
	if (b[1] !== a[1]) return b[1] - a[1];
	return a[0].localeCompare(b[0]);
});
---

<PageLayout title="All Tags" description="A list of all the topics I've written about in my posts">
	<div class="flex w-full flex-col gap-y-8">
		<div>
			<h1 class="mb-2 text-2xl font-semibold">Tags</h1>
			<p class="text-muted-foreground">A list of all the topics I've written about in my posts</p>
		</div>
		<div class="flex max-w-xl flex-col">
			<p class="text-muted-foreground">
				{sortedTags.length} tags across {allPosts.length} posts
			</p>
		</div>

		{sortedTags.length === 0 && <p class="text-muted-foreground">No posts yet.</p>}

		{
			sortedTags.length > 0 && (
				<div class="flex flex-wrap gap-3">
					{sortedTags.map(([tag, count]) => (
						<a
							href={`/tags/${tag}/`}
							title={`View ${count} post${count > 1 ? "s" : ""} tagged with "${tag}"`}
							data-astro-prefetch
							class="group bg-secondary/50 hover:bg-secondary text-foreground/80 hover:text-foreground flex items-center gap-2 rounded-lg px-4 py-2 transition-all"
						>
							<span class="font-medium">#{tag}</span>
							<span class="bg-muted text-muted-foreground group-hover:bg-primary group-hover:text-primary-foreground rounded-full px-2 py-0.5 text-xs transition-colors">
								{count}
							</span>
						</a>
					))}
				</div>
			)
		}
	</div>
</PageLayout>
