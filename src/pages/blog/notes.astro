---
export const prerender = true;

import BlogTabs from "@/components/blog/BlogTabs.astro";
import PageLayout from "@/layouts/BaseLayout.astro";
import {
	getFormattedDate,
	getPostsByCategory,
	getReadTimeCount,
	groupPostsByYear,
} from "@/lib/utils";

const allPosts = await getPostsByCategory("notes");
const postsByYear = groupPostsByYear(allPosts);
---

<PageLayout
	title="Notes"
	description="Learning notes, tutorials, and project documentation."
	pageType="website"
>
	<div class="flex w-full flex-col gap-y-6">
		<BlogTabs activeTab="notes" />

		{allPosts.length === 0 && <p class="text-muted-foreground">No notes yet.</p>}

		{
			allPosts.length > 0 && (
				<div class="flex flex-col gap-y-12">
					{[...postsByYear.entries()].map(([year, posts]) => (
						<section class="relative">
							<div class="text-muted-foreground/10 pointer-events-none absolute -top-8 -left-4 text-8xl font-bold select-none md:-left-8 md:text-9xl">
								{year}
							</div>
							<ul class="relative flex flex-col">
								{posts.map((post) => (
									<li>
										<a
											href={`/blog/${post.slug}`}
											class="group hover:bg-muted/30 -mx-3 flex flex-col gap-1 rounded-lg px-3 py-3 transition-colors sm:flex-row sm:items-baseline sm:gap-4"
										>
											<span class="group-hover:text-foreground font-medium transition-colors">
												{post.data.title}
											</span>
											<span class="text-muted-foreground text-sm">
												{getFormattedDate(post.data.date)}
												{post.body && ` Â· ${getReadTimeCount(post.body)}min`}
											</span>
										</a>
									</li>
								))}
							</ul>
						</section>
					))}
				</div>
			)
		}
	</div>
</PageLayout>
